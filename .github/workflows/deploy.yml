name: Deploy Casino Application

on:
  push:
    branches:
      - main
      - master
  workflow_dispatch:

jobs:
  deploy:
    name: Deploy to Production
    runs-on: ubuntu-latest

    steps:
      - name: Send Telegram notification - Deploy started
        if: always()
        run: |
          curl -s -X POST "https://api.telegram.org/bot${{ secrets.TELEGRAM_BOT_TOKEN }}/sendMessage" \
            -d chat_id="${{ secrets.TELEGRAM_CHAT_ID }}" \
            -d text="üöÄ –î–µ–ø–ª–æ–π –Ω–∞—á–∞–ª—Å—è%0A%0A–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π: ${{ github.repository }}%0A–í–µ—Ç–∫–∞: ${{ github.ref_name }}%0A–ö–æ–º–º–∏—Ç: ${{ github.sha }}%0A–ê–≤—Ç–æ—Ä: ${{ github.actor }}"

      - name: Deploy to Server
        id: deploy
        uses: appleboy/ssh-action@v1.0.3
        with:
          host: ${{ secrets.SSH_HOST }}
          username: ${{ secrets.SSH_USERNAME }}
          password: ${{ secrets.SSH_PASSWORD }}
          key: ${{ secrets.SSH_PRIVATE_KEY }}
          port: ${{ secrets.SSH_PORT || 22 }}
          script: |
            cd ${{ secrets.DEPLOY_PATH || '/var/www/minedrop/' }}
            git pull && npm run build

      - name: Send Telegram notification - Deploy succeeded
        if: success()
        run: |
          curl -s -X POST "https://api.telegram.org/bot${{ secrets.TELEGRAM_BOT_TOKEN }}/sendMessage" \
            -d chat_id="${{ secrets.TELEGRAM_CHAT_ID }}" \
            -d text="‚úÖ –î–µ–ø–ª–æ–π —É—Å–ø–µ—à–Ω–æ –∑–∞–≤–µ—Ä—à–µ–Ω%0A%0A–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π: ${{ github.repository }}%0A–í–µ—Ç–∫–∞: ${{ github.ref_name }}%0A–ö–æ–º–º–∏—Ç: ${{ github.sha }}"

      - name: Send Telegram notification - Deploy failed
        if: failure()
        run: |
          curl -s -X POST "https://api.telegram.org/bot${{ secrets.TELEGRAM_BOT_TOKEN }}/sendMessage" \
            -d chat_id="${{ secrets.TELEGRAM_CHAT_ID }}" \
            -d text="‚ùå –î–µ–ø–ª–æ–π –∑–∞–≤–µ—Ä—à–∏–ª—Å—è —Å –æ—à–∏–±–∫–æ–π%0A%0A–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π: ${{ github.repository }}%0A–í–µ—Ç–∫–∞: ${{ github.ref_name }}%0A–ö–æ–º–º–∏—Ç: ${{ github.sha }}%0A%0A–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ GitHub Actions –¥–ª—è –¥–µ—Ç–∞–ª–µ–π."